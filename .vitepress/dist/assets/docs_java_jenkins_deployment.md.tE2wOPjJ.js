import{_ as n,c as a,o as l,ag as p}from"./chunks/framework.Ds6Eueu6.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docs/java/jenkins/deployment.md","filePath":"docs/java/jenkins/deployment.md","lastUpdated":null}'),e={name:"docs/java/jenkins/deployment.md"};function o(r,s,c,t,y,i){return l(),a("div",null,s[0]||(s[0]=[p(`<div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki vitesse-light vp-code" tabindex="0"><code><span class="line"><span style="color:#59873A;">---</span></span>
<span class="line"><span style="color:#998418;">kind</span><span style="color:#999999;">:</span><span style="color:#B56959;"> Deployment</span></span>
<span class="line"><span style="color:#998418;">apiVersion</span><span style="color:#999999;">:</span><span style="color:#B56959;"> apps/v1</span></span>
<span class="line"><span style="color:#998418;">metadata</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">  name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${APP_NAME}-\${MODULE_NAME}</span><span style="color:#A0ADA0;"> # 部署名称，由应用名和模块名组成</span></span>
<span class="line"><span style="color:#998418;">  namespace</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${REGISTRY_NAMESPACE}</span><span style="color:#A0ADA0;"> # 命名空间</span></span>
<span class="line"><span style="color:#998418;">  labels</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">    app</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${APP_NAME}-\${MODULE_NAME}</span><span style="color:#A0ADA0;"> # 标签，用于标识应用</span></span>
<span class="line"><span style="color:#998418;">spec</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">  replicas</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 1</span><span style="color:#A0ADA0;"> # 副本数量</span></span>
<span class="line"><span style="color:#998418;">  selector</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">    matchLabels</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">      app</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${APP_NAME}-\${MODULE_NAME}</span><span style="color:#A0ADA0;"> # 匹配的标签</span></span>
<span class="line"><span style="color:#998418;">  template</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">    metadata</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">      creationTimestamp</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> null</span></span>
<span class="line"><span style="color:#998418;">      labels</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">        app</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${APP_NAME}-\${MODULE_NAME}</span><span style="color:#A0ADA0;"> # 模板标签</span></span>
<span class="line"><span style="color:#998418;">    spec</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">      volumes</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">        -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> host-time</span><span style="color:#A0ADA0;"> # 挂载主机时间</span></span>
<span class="line"><span style="color:#998418;">          hostPath</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">            path</span><span style="color:#999999;">:</span><span style="color:#B56959;"> /etc/localtime</span><span style="color:#A0ADA0;"> # 主机时间路径</span></span>
<span class="line"><span style="color:#998418;">            type</span><span style="color:#999999;">:</span><span style="color:#B5695977;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#999999;">        -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> localdata</span><span style="color:#A0ADA0;"> # 临时数据存储卷</span></span>
<span class="line"><span style="color:#998418;">          emptyDir</span><span style="color:#999999;">:</span><span style="color:#999999;"> {}</span></span>
<span class="line"><span style="color:#998418;">      initContainers</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">        -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> code-init</span><span style="color:#A0ADA0;"> # 初始化容器名称</span></span>
<span class="line"><span style="color:#998418;">          image</span><span style="color:#999999;">:</span><span style="color:#B56959;"> \${REGISTRY}/\${REGISTRY_NAMESPACE}/\${APP_NAME}-\${MODULE_NAME}:\${VERSION_NUMBER}</span><span style="color:#A0ADA0;"> # 初始化容器镜像</span></span>
<span class="line"><span style="color:#998418;">          command</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#B56959;"> sh</span></span>
<span class="line"><span style="color:#998418;">          args</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#B5695977;"> &#39;</span><span style="color:#B56959;">-c</span><span style="color:#B5695977;">&#39;</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#B56959;"> cp /code/\${JAR_NAME} /localdata</span><span style="color:#A0ADA0;"> # 将代码复制到临时目录</span></span>
<span class="line"><span style="color:#998418;">          ports</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> http-80</span><span style="color:#A0ADA0;"> # 暴露的端口名称</span></span>
<span class="line"><span style="color:#998418;">              containerPort</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 80</span><span style="color:#A0ADA0;"> # 容器端口</span></span>
<span class="line"><span style="color:#998418;">              protocol</span><span style="color:#999999;">:</span><span style="color:#B56959;"> TCP</span><span style="color:#A0ADA0;"> # 协议</span></span>
<span class="line"><span style="color:#998418;">          resources</span><span style="color:#999999;">:</span><span style="color:#999999;"> {}</span><span style="color:#A0ADA0;"> # 资源限制</span></span>
<span class="line"><span style="color:#998418;">          volumeMounts</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> host-time</span><span style="color:#A0ADA0;"> # 挂载主机时间卷</span></span>
<span class="line"><span style="color:#998418;">              readOnly</span><span style="color:#999999;">:</span><span style="color:#1E754F;"> true</span></span>
<span class="line"><span style="color:#998418;">              mountPath</span><span style="color:#999999;">:</span><span style="color:#B56959;"> /etc/localtime</span><span style="color:#A0ADA0;"> # 挂载路径</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> localdata</span><span style="color:#A0ADA0;"> # 挂载临时数据卷</span></span>
<span class="line"><span style="color:#998418;">              mountPath</span><span style="color:#999999;">:</span><span style="color:#B56959;"> /localdata</span><span style="color:#A0ADA0;"> # 挂载路径</span></span>
<span class="line"><span style="color:#998418;">          imagePullPolicy</span><span style="color:#999999;">:</span><span style="color:#B56959;"> IfNotPresent</span><span style="color:#A0ADA0;"> # 镜像拉取策略</span></span>
<span class="line"><span style="color:#998418;">      containers</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">        -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> java</span><span style="color:#A0ADA0;"> # 主容器名称</span></span>
<span class="line"><span style="color:#998418;">          image</span><span style="color:#999999;">:</span><span style="color:#B5695977;"> &#39;</span><span style="color:#B56959;">openjdk:8u275-jre</span><span style="color:#B5695977;">&#39;</span><span style="color:#A0ADA0;"> # 主容器镜像</span></span>
<span class="line"><span style="color:#998418;">          command</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#B56959;"> sh</span></span>
<span class="line"><span style="color:#998418;">          args</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#B5695977;"> &#39;</span><span style="color:#B56959;">-c</span><span style="color:#B5695977;">&#39;</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#1E754F;"> &gt;</span><span style="color:#AB5959;">-</span></span>
<span class="line"><span style="color:#B56959;">              java -jar -Xms256m -Xmx256m</span></span>
<span class="line"><span style="color:#B56959;">              -Dspring.profiles.active=\${PROFILES_ACTIVE} -Dserver.port=80</span></span>
<span class="line"><span style="color:#B56959;">              /code/\${JAR_NAME} # 启动 Java 应用的命令</span></span>
<span class="line"><span style="color:#998418;">          ports</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> http-80</span><span style="color:#A0ADA0;"> # 暴露的端口名称</span></span>
<span class="line"><span style="color:#998418;">              containerPort</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 80</span><span style="color:#A0ADA0;"> # 容器端口</span></span>
<span class="line"><span style="color:#998418;">              protocol</span><span style="color:#999999;">:</span><span style="color:#B56959;"> TCP</span><span style="color:#A0ADA0;"> # 协议</span></span>
<span class="line"><span style="color:#998418;">          env</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> TZ</span><span style="color:#A0ADA0;"> # 设置时区环境变量</span></span>
<span class="line"><span style="color:#998418;">              value</span><span style="color:#999999;">:</span><span style="color:#B56959;"> Asia/Shanghai</span><span style="color:#A0ADA0;"> # 时区值</span></span>
<span class="line"><span style="color:#998418;">          resources</span><span style="color:#999999;">:</span><span style="color:#999999;"> {}</span><span style="color:#A0ADA0;"> # 资源限制</span></span>
<span class="line"><span style="color:#998418;">          volumeMounts</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> host-time</span><span style="color:#A0ADA0;"> # 挂载主机时间卷</span></span>
<span class="line"><span style="color:#998418;">              readOnly</span><span style="color:#999999;">:</span><span style="color:#1E754F;"> true</span></span>
<span class="line"><span style="color:#998418;">              mountPath</span><span style="color:#999999;">:</span><span style="color:#B56959;"> /etc/localtime</span><span style="color:#A0ADA0;"> # 挂载路径</span></span>
<span class="line"><span style="color:#999999;">            -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> localdata</span><span style="color:#A0ADA0;"> # 挂载临时数据卷</span></span>
<span class="line"><span style="color:#998418;">              mountPath</span><span style="color:#999999;">:</span><span style="color:#B56959;"> /code</span><span style="color:#A0ADA0;"> # 挂载路径</span></span>
<span class="line"><span style="color:#998418;">          imagePullPolicy</span><span style="color:#999999;">:</span><span style="color:#B56959;"> IfNotPresent</span><span style="color:#A0ADA0;"> # 镜像拉取策略</span></span>
<span class="line"><span style="color:#998418;">      restartPolicy</span><span style="color:#999999;">:</span><span style="color:#B56959;"> Always</span><span style="color:#A0ADA0;"> # 重启策略</span></span>
<span class="line"><span style="color:#998418;">      terminationGracePeriodSeconds</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 30</span><span style="color:#A0ADA0;"> # 优雅终止时间</span></span>
<span class="line"><span style="color:#998418;">      dnsPolicy</span><span style="color:#999999;">:</span><span style="color:#B56959;"> ClusterFirst</span><span style="color:#A0ADA0;"> # DNS 策略</span></span>
<span class="line"><span style="color:#998418;">      imagePullSecrets</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">        -</span><span style="color:#998418;"> name</span><span style="color:#999999;">:</span><span style="color:#B56959;"> harbor-registry-secret</span><span style="color:#A0ADA0;"> # 镜像拉取密钥</span></span>
<span class="line"><span style="color:#998418;">  strategy</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">    type</span><span style="color:#999999;">:</span><span style="color:#B56959;"> RollingUpdate</span><span style="color:#A0ADA0;"> # 滚动更新策略</span></span>
<span class="line"><span style="color:#998418;">    rollingUpdate</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#998418;">      maxUnavailable</span><span style="color:#999999;">:</span><span style="color:#B56959;"> 25%</span><span style="color:#A0ADA0;"> # 最大不可用副本数</span></span>
<span class="line"><span style="color:#998418;">      maxSurge</span><span style="color:#999999;">:</span><span style="color:#B56959;"> 25%</span><span style="color:#A0ADA0;"> # 最大新增副本数</span></span>
<span class="line"><span style="color:#998418;">  revisionHistoryLimit</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 10</span><span style="color:#A0ADA0;"> # 修订历史限制</span></span>
<span class="line"><span style="color:#998418;">  progressDeadlineSeconds</span><span style="color:#999999;">:</span><span style="color:#2F798A;"> 600</span><span style="color:#A0ADA0;"> # 更新进度超时时间</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div>`,1)]))}const m=n(e,[["render",o]]);export{A as __pageData,m as default};
